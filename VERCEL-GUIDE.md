## 🚀 Vercel 배포 가이드

> Docker로 로컬 개발은 끝났는데, 이걸 어떻게 친구들에게 보여주거나 포트폴리오로 활용할 수 있을까요?
>
> 이 문서는 여러분이 Docker 환경에서 개발한 챗봇 프로젝트를 **Vercel CLI**를 사용하여 누구나 사용할 수 있는 배포환경을 구성하겠습니다.

---

### 🤔 Vercel, 왜 사용해야 할까요?

- **간편함:** 복잡한 서버 설정(Nginx, Gunicorn 등) 없이, 명령어 몇 줄만으로 Python Flask 앱을 배포할 수 있습니다.
- **비용 효율:** 개인 프로젝트나 소규모 트래픽은 무료 플랜으로 충분히 운영 가능합니다.
- **서버리스:** 사용자가 접속할 때만 서버(Lambda)가 동작하므로, 관리 부담이 없고 효율적입니다.

---

### 🔧 배포 환경 구축을 위한 준비물

배포를 시작하기 전에 다음 3가지를 확인해주세요.

- [ ] **로컬에서 완벽히 동작하는 프로젝트:** `DOCKER-GUIDE.md`를 따라 로컬(`http://localhost:5001`)에서 챗봇이 완벽하게 동작하는 것을 확인해야 합니다.
- [ ] **Vercel 계정:** [Vercel 홈페이지](https://vercel.com/)에서 GitHub 계정으로 가입하는 것을 권장합니다.
- [ ] **Node.js 및 npm:** Vercel CLI는 `npm`(Node Package Manager)을 통해 설치됩니다. [Node.js 공식 사이트](https://nodejs.org/)에서 LTS 버전을 설치하세요.

---

### 🚀 Vercel CLI를 이용한 단계별 배포 가이드

#### 1단계: Vercel CLI 설치

터미널을 열고 아래 명령어를 입력하여 Vercel CLI를 전역(`global`)으로 설치합니다.

```bash
npm install -g vercel
```

설치가 완료되면, 버전을 확인하여 정상적으로 설치되었는지 검증합니다.

```bash
vercel --version
```

#### 2단계: Vercel 로그인

아래 명령어를 실행하면, 브라우저를 통해 Vercel 계정으로 로그인하라는 안내가 나타납니다.

```bash
vercel login
```

> 이메일 인증 또는 GitHub 계정 연동을 통해 로그인을 완료하세요.

### Vercel link

```bash
# Vercel에 OPENAI_API_KEY 라는 이름의 환경 변수를 추가합니다.
vercel link
```

#### 3단계: 환경 변수 설정 (매우 중요)

우리 프로젝트는 OpenAI API 키를 `.env` 파일에서 읽어 사용했지만, 이 파일은 보안상 GitHub에 올라가지 않습니다. 따라서 Vercel 서버가 API 키를 알 수 있도록, **Vercel의 환경 변수로 직접 등록**해주어야 합니다.

터미널에서 프로젝트 폴더로 이동한 뒤, 아래 명령어를 실행하세요.

```bash
# Vercel에 OPENAI_API_KEY 라는 이름의 환경 변수를 추가합니다.
vercel env add OPENAI_API_KEY
```

명령어를 실행하면, Vercel CLI가 API 키의 값을 물어봅니다.

> `What’s the value of OPENAI_API_KEY?`
>
> 여기에 `sk-`로 시작하는 **본인의 OpenAI API 키를 그대로 붙여넣고** Enter를 누르세요.

그 다음 어떤 환경에 적용할지 물으면, 키보드 `Enter` 키를 눌러 기본 설정(모든 환경에 적용)으로 진행하면 됩니다.

#### 4단계: 프로덕션(Production) 배포

이제 모든 준비가 끝났습니다. 아래 명령어 한 줄로 여러분의 챗봇을 실제 웹사이트로 배포할 수 있습니다.

프로젝트 폴더 최상위 경로에서 아래 명령어를 실행하세요.

```bash
vercel --prod
```

처음 실행하면, Vercel CLI가 현재 폴더를 어떤 Vercel 프로젝트에 연결할지 물어봅니다. 대부분의 경우 기본 설정으로 Enter만 누르면 됩니다.

> `vercel.json` 파일이 이미 프로젝트에 포함되어 있으므로, Vercel은 이 프로젝트가 Python Flask 앱이라는 것을 자동으로 인식하고 빌드와 배포를 시작합니다.

배포가 성공적으로 완료되면, 터미널에 **`Production`** URL이 표시됩니다. (예: `https://your-project-name.vercel.app`)

이 URL을 복사하여 웹 브라우저에 붙여넣고, 여러분의 챗봇이 전 세계 어디서든 잘 동작하는지 최종 확인하세요!

---

### 💡 개발용 Docker vs. 배포용 Docker: 심화 학습 (Advanced)

"배포를 하려면, 지금까지 쓰던 Docker 설정을 바꿔야 하나요?" 라는 궁금증이 생길 수 있습니다. 매우 좋은 질문입니다.

#### **Vercel 배포: 왜 Docker 설정 변경이 필요 없을까요?**

결론부터 말씀드리면, **이 프로젝트를 Vercel에 배포할 때 여러분이 Docker 설정을 바꿀 필요는 전혀 없습니다.**

그 이유는 Vercel이 우리가 만든 `Dockerfile`이나 `docker-compose.yml`을 직접 사용하지 않기 때문입니다. Vercel은 우리 프로젝트의 소스 코드를 바탕으로 **자신만의 최적화된 배포 환경을 처음부터 다시 구축**합니다. (`requirements.txt`를 읽어 라이브러리를 설치하고, `app.py`를 실행하는 등)

따라서 우리가 사용한 Docker 설정은 오직 **여러분의 로컬 컴퓨터에서 일관된 "개발" 환경을 제공하기 위한 도구**입니다.

#### **(참고) 일반적인 서버 배포 환경이라면?**

만약 Vercel이 아닌, AWS EC2 같은 일반 서버에 직접 Docker를 배포한다면 **배포용으로 최적화된 Docker 설정**이 반드시 필요합니다. 개발용과 배포용의 차이는 다음과 같습니다.

| 항목          | 개발용 Docker 설정 (현재 우리 프로젝트)           | 배포용 Docker 설정 (일반적인 경우)                                          |
| :------------ | :------------------------------------------------ | :-------------------------------------------------------------------------- |
| **핵심 목표** | **개발 편의성, 빠른 반영**                        | **성능, 안정성, 보안, 작은 용량**                                           |
| **코드 반영** | **`volumes` 사용.** 코드 수정이 즉시 반영.        | **`COPY` 명령어 사용.** 코드를 이미지 안에 "구워서" 넣음.                   |
| **웹 서버**   | **Flask 개발 서버.** 개발에 편리하지만 성능 한계. | **Gunicorn WSGI 서버.** 여러 요청을 동시에 처리하는 프로덕션용 고성능 서버. |
| **디버깅**    | **디버그 모드 활성화.** 보안에 취약.              | **디버그 모드 비활성화.** 안정성 확보.                                      |

따라서 **안심하고 현재 상태 그대로** Vercel 배포를 진행하시면 됩니다.

---

### Troubleshooting

- **문제: 배포(빌드)가 실패해요.**

  - **해결:** `requirements.txt`에 오타나 잘못된 라이브러리 이름이 없는지 확인하세요. Vercel의 빌드 로그를 자세히 살펴보면 대부분의 원인을 찾을 수 있습니다.
  - Vercel 웹에 접속해서 dashboard 에서 build 실패 이유를 직접 확인해보세요.

- **문제: 배포는 성공했는데, 사이트에서 500 에러가 발생해요.**

  - **해결:** 가장 흔한 원인은 **환경 변수 누락**입니다. 3단계에서 `OPENAI_API_KEY`가 제대로 등록되었는지 다시 확인하세요. Vercel 웹사이트의 대시보드에 있는 "Logs" 탭에서 실시간 서버 로그를 확인하는 것도 큰 도움이 됩니다.

- **문제: 사이트는 뜨는데 CSS나 이미지가 깨져요.**
  - **해결:** `vercel.json` 파일의 `routes` 설정이 올바른지 확인하세요. 현재 프로젝트의 설정은 대부분의 경우에 잘 동작하도록 구성되어 있습니다.
