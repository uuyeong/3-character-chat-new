<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ bot.name }} - 상세 정보</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap"
      rel="stylesheet"
    />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: "IBM Plex Sans KR", sans-serif;
      }
      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background-image: url("{{ url_for('static', filename='images/chatbot/background/bg.png') }}");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        overflow: hidden;
        padding: 16px 0;
      }
      .modal-container {
        max-width: 460px;
        width: 92%;
        height: min(695px, calc(100vh - 10px));
        background: linear-gradient(to bottom, rgba(184, 229, 245, 0.9) 0%, rgba(232, 212, 245, 0.9) 100%);
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding: 18px 22px;
        box-sizing: border-box;
      }
      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        background: transparent;
        padding-bottom: 12px;
      }
      .modal-header h2 {
        margin: 0;
        flex: 1;
        text-align: center;
        font-size: 1.5rem;
        color: #333;
      }
      .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
      }
      .modal-content {
        flex: 1;
        width: 100%;
        background: transparent;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        gap: 12px;
      }

      @media (max-height: 700px) {
        .modal-content {
          gap: 10px;
        }
        .bot-image {
          max-width: 180px !important;
        }
      }
      .bot-image {
        width: 200px;
        height: auto;
        border-radius: 25px;
        display: block;
        margin: 0 auto 10px;
      }
      .bot-info {
        text-align: center;
      }
      .bot-info h1 {
        margin: 0 0 10px 0;
        font-size: 1.5rem;
        color: #333;
      }
      .bot-info p {
        margin: 12px 0;
        font-size: 0.92rem;
        color: #666;
        line-height: 1.6;
      }
      .tags {
        margin: 15px 0;
      }
      .tag {
        display: inline-block;
        background: rgba(221, 238, 255, 0.7);
        color: #555;
        padding: 6px 12px;
        border-radius: 15px;
        margin: 4px;
        font-size: 0.9rem;
      }
      .username-area {
        margin: 10px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }
      .username-area label {
        font-size: 0.95rem;
        color: #333;
      }
      .username-area input {
        padding: 8px 12px;
        font-size: 0.95rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        width: 48%;
        transition: border 0.2s;
      }
      .username-area input:focus {
        outline: none;
        border-color: #764ba2;
      }
      .start-chat {
        display: block;
        margin: 10px 0;
        padding: 11px 20px;
        background: rgba(118, 75, 162, 0.7);
        color: #fff;
        text-decoration: none;
        border-radius: 25px;
        font-size: 1rem;
        text-align: center;
        cursor: pointer;
        transition: transform 0.2s;
        border: none;
        width: 100%;
      }
      .start-chat:hover {
        transform: translateY(-2px);
      }
      .info-btn {
        display: block;
        margin: 0px 0 10px 0;
        margin-top: -10px;
        padding: 10px 20px;
        background: rgba(210, 197, 222, 0.8);
        color: #555;
        text-decoration: none;
        border-radius: 25px;
        font-size: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid #f6e7ff;
        width: 100%;
      }
      .info-btn:hover {
        background: #e0e0e0;
        border-color: #764ba2;
      }
      /* 설명 모달 스타일 */
      .intro-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }
      .intro-modal.active {
        display: flex;
      }
      .intro-content {
        background: linear-gradient(to bottom, rgba(184, 229, 245, 0.7) 0%, rgba(214, 212, 245, 0.7) 100%);
        border-radius: 16px;
        max-width: 700px;
        width: 90%;
        max-height: 85vh;
        overflow-y: auto;
        overflow-x: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        position: relative;
        padding: 30px;
      }
      
      @media (max-height: 700px) {
        .intro-content {
          padding: 20px;
          max-height: 90vh;
        }
      }
      .intro-close {
        position: absolute;
        top: 15px;
        right: 20px;
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        color: #999;
        transition: color 0.2s;
      }
      .intro-close:hover {
        color: #333;
      }
      .intro-header {
        display: flex;
        align-items: flex-start;
        gap: 20px;
        margin-bottom: 30px;
      }
      .intro-owl {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 1px solid rgba(118, 75, 162, 0.7);
        flex-shrink: 0;
      }
      .intro-speech-bubble {
        flex: 1;
        background: rgba(255, 255, 255, 0.6);
        padding: 20px;
        border-radius: 16px;
        position: relative;
        font-size: 1rem;
        line-height: 1.8;
        color: #333;
      }
      .intro-speech-bubble::before {
        content: '';
        position: absolute;
        left: -10px;
        top: 20px;
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-right: 10px solid rgba(255, 255, 255, 0.6);
      }
      .intro-start-btn {
        display: block;
        width: 100%;
        padding: 14px;
        background: #764ba2;
        color: #fff;
        border: none;
        border-radius: 25px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 20px;
      }
      .intro-start-btn:hover {
        background: #5a3880;
        transform: translateY(-2px);
      }
      @media (max-height: 880px) {
        .modal-container {
          transform: scale(0.9);
          transform-origin: center;
        }
      }
      @media (max-height: 800px) {
        .modal-container {
          transform: scale(0.84);
          transform-origin: center;
        }
      }
      @media (max-height: 720px) {
        .modal-container {
          transform: scale(0.78);
          transform-origin: center;
        }
      }
      @media (max-height: 660px) {
        .modal-container {
          transform: scale(0.72);
          transform-origin: center;
        }
      }
      @media (max-height: 600px) {
        .modal-container {
          transform: scale(0.66);
          transform-origin: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="modal-container">
      <div class="modal-header">
        <h2>✨별빛 우체국✨</h2>
        <button
          class="close-btn"
          data-href="{{ url_for('index') }}"
        >
          &times;
        </button>
      </div>

      <div class="modal-content">
        <img
          src="{{ url_for('static', filename='images/chatbot/owl/owl_profile.png') }}"
          alt="{{ bot.name }}"
          class="bot-image"
        />

        <div class="bot-info">
          <h1>부엉 우체국장</h1>

          <div class="tags">
            {% for tag in bot.tags %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
          </div>
        </div>

        <div class="username-area">
          <label for="username">이름:</label>
          <input type="text" id="username" placeholder="이름을 입력하세요" />
        </div>

        <button class="start-chat" id="start-chat-btn">채팅 시작하기</button>
        <button class="info-btn" id="info-btn">들어가기 전에…</button>
      </div>
    </div>

    <!-- 설명 모달 -->
    <div class="intro-modal" id="intro-modal">
      <div class="intro-content">
        <button class="intro-close" id="intro-close">&times;</button>
        
        <div class="intro-header">
          <img src="{{ url_for('static', filename='images/chatbot/owl/owl_profile.png') }}" alt="부엉장" class="intro-owl" />
          <div class="intro-speech-bubble">
            <p>
              흐음. (장부를 뒤적이며) 자네가 이곳 "별빛 우체국"에 온 것을 확인했다.
            </p>
            <p>
              나는 우체국장 부엉이지. 여기는 시간의 경계일세. 
            </p>
            <p>
              다른 세계선의 너로부터 온 편지가 이곳에 보관되어 있지.
            </p>
            <p>
              네가 여기서 나누는 대화가 그 편지를 찾는 열쇠가 되겠군.
            </p>
            <p>
              네 기억을 더듬어보자고...
            </p>
          </div>
        </div>
        
        <button class="intro-start-btn" id="intro-start-btn">이해했어요, 시작할게요</button>
      </div>
    </div>

    <script>
      const startChatBtn = document.getElementById("start-chat-btn");
      const usernameInput = document.getElementById("username");
      const infoBtn = document.getElementById("info-btn");
      const introModal = document.getElementById("intro-modal");
      const introClose = document.getElementById("intro-close");
      const introStartBtn = document.getElementById("intro-start-btn");
      const closeBtn = document.querySelector(".close-btn");

      // 채팅 시작
      function startChat() {
        const username = usernameInput.value.trim() || "사용자";
        window.location.href = `/chat?username=${encodeURIComponent(username)}`;
      }

      startChatBtn.addEventListener("click", function (event) {
        event.preventDefault();
        startChat();
      });

      usernameInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          startChat();
        }
      });

      //'들어가기 전에...' 버튼
      infoBtn.addEventListener("click", function (event) {
        event.preventDefault();
        introModal.classList.add("active");
      });

      introClose.addEventListener("click", function () {
        introModal.classList.remove("active");
      });

      introModal.addEventListener("click", function (event) {
        if (event.target === introModal) {
          introModal.classList.remove("active");
        }
      });

      introStartBtn.addEventListener("click", function () {
        introModal.classList.remove("active");
        startChat();
      });

      closeBtn.addEventListener("click", function () {
        window.location.href = this.dataset.href;
      });
    </script>
  </body>
</html>
